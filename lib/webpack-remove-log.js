/**
 * Created by yasem on 10.07.2016.
 */

var WebpackRemoveLog = function () {
};

WebpackRemoveLog.prototype.apply = function (compiler) {
    var self = this;

    compiler.plugin("emit", function (compilation, callback) {
        compilation.chunks.forEach(function (chunk) {

            // Explore each asset filename generated by the chunk and replace the console.* methods:
            chunk.files.forEach(function (filename) {

                // Get the asset source for each file generated by the chunk:
                var source = compilation.assets[filename].source();

                //Console.log|debug|info|warn|error regexp
                var rConsole=new RegExp(/console.(log|debug|info|warn|error)( ?| +)\([^;]*\);?/ig);

                //Regexp replace null
                source = source.replace(rConsole, function() {
                    return source.replaceWith || "";
                });

                compilation.assets[filename] = {
                    source: function () {
                            return source;
                        },
                    size: function () {
                            return source.length;
                        }
                }
            });
        });
        callback();
    });
};

module.exports = WebpackRemoveLog;
